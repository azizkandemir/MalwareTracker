import sqlite3
import time
import config

db_folder = config.database_folder
db_to_convert = db_folder + config.db_to_convert
new_db = db_folder + config.converted_db    # comment this line and uncomment next line in order to CREATE a new
                                            # details database with datetime format.

#new_db = config.api_database_folder + config.converted_db


def convert_epoch_to_datetime(epoch_to_convert):
    return time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(epoch_to_convert))


conn = sqlite3.connect(db_to_convert)
c = conn.cursor()
c.execute("SELECT * FROM data")
rows = c.fetchall()
c.close()
conn.close()

new_list = []

for item in rows:
    lst = list(item)
    lst[3] = convert_epoch_to_datetime(lst[3])
    item = tuple(lst)
    new_list.append(item)


conn = sqlite3.connect(new_db)
c = conn.cursor()
c.execute("CREATE TABLE IF NOT EXISTS data (hash text, f_type text, source text, date number)")
c.execute('CREATE UNIQUE INDEX IF NOT EXISTS source_index ON data(source)')
c.executemany("INSERT OR IGNORE INTO data VALUES(?, ?, ?, ?);", new_list, )
conn.commit()
c.close()
conn.close()





