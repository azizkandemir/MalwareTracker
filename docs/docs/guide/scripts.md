# **Introduction**

There are 2 types of scripts in this projects,

- Python Scripts

- Bash Scripts

Python Scripts are using for converting epoch time format into datetime format, fetching malware data from 3 different
websites.

Bash Scripts are using for handling python scripts.

## Python Scripts
---

###**`malshare_api.py`**
This script parses [malshare](https://malshare.com) website for the malware data by using website's APIs.

It has 6 different arguments:

- `--untilyesterday`, `-uyes`       
  
-  `--hash2detail`, `-h2d`
          
-  `--sources24`, `-s24`            
 
-  `--update24`, `-up24`            

-  `--bydate BYDATE`, `-bd BYDATE`  

-  `--update`, `-up`  

---

#### **`--untilyesterday` `-uyes`**

This argument gets the all MD5 hashes since the date that you provide by `first_epoch_of_hash` variable in **`config.py`**.

It is initially set to **1505347200** which is the date (2017-09-14) of first archived data in [malshare](https://malshare.com/daily/).



#### **`--hash2detail` `-h2d`**

This argument deals with 2 databases:

- Database that contains MD5 hashes and date in epoch format.

- Database that will be created and will be contain details of related MD5 hash that referenced from hashes database.


#### **`--sources24` `-s24`**

This argument gets the sources of past 24 hours and creates a database with 2 columns **(source, date in epoch format)**
with the name that you provide by `hashes_db_name` variable to **`config.py`**.

It uses malshare's own API for getting last 24 hours sources.

#### **`--update24` `-up24`**

This argument gets the details of yesterday and updates the intended database which needs to be provided with the `fixed_hashes_db`
variable in **`config.py`**.

It gets the hashes of 1 day before of today's date from malshare [archives](https://malshare.com/daily/). For example:

Lets assume that today's date is **2018-07-17** so when you run the script with this argument, it will look for the hashes of
 **2018-07-16** which is yesterday. It will go [here](https://malshare.com/daily/) and get **malshare_fileList.2018-07-16.txt**
 from **2018-07-16** directory. This [txt](https://malshare.com/daily/2018-07-16/malshare_fileList.2018-07-16.txt) file 
 contains MD5 hashes of **2018-07-16**.
 
 After the script gets the hashes of yesterday, it will check for the details of every each MD5 hashes by using website's
 API which is:
 
```
/api.php?api_key=[API_KEY]&action=details&hash=[HASH]
```
 
It will collect 3 information from this API;
 
 - **MD5**
 
 - **F_TYPE**
 
 - **SOURCES**

Since script collected 3 information that we desire from the API it will just put the date of yesterday for the 4th element
and it will create a database for details which needs to be provided with the `malshare_db_name` variable in **`config.py`**.
It is initially set to **'malshare.db'** but of course you can change it as you want.

At the end we will have a database which contains the details of yesterday recorded data with 4 columns;

- **hash**
- **f_type**
- **source**
- **date** (in datetime format)

#### **`--bydate BYDATE` `-bd BYDATE`**

This argument is for getting MD5 hashes of specific date that you provide by second argument. Date needs to be in
**YYYY-MM-DD** format. 

For getting the hashes recorded at 'November 20th, 2017' second argument needs to be given like this: `2017-10-20`

```
../MalwareTracker>python3 malshare_script.py -bd 2017-10-20
```

By this command, in the folder that you provide with `database_folder` variable in **`config.py`**, a database will
be created with the name that you provide with `hashes_db_name` variable in **`config.py`**.
 
This database will have 2 columns:
 
 - **hash**
 - **date** (in epoch format)

#### **`--update` `-up`**

This argument is for updating the intended details database with the last 200 entries that recorded in malshare. Actually
this argument is using the malshare website's API which lists hashes from the past 24 hours.;
```
/api.php?api_key=[API_KEY]&action=details&hash=[HASH]
```
Since I wanted to update my system for every 20 minutes, it is unnecessary to fetch all of the hashes from the past 24
hours. That is the reason why this script gets the **last** 200 entries that recorded and can be accessible by this API.

By this argument, in the folder that you provide with `api_database_folder` variable in **`config.py`**;

- if there is not a details database with the name that you provide with `malshare_db_name` variable in **`config.py`**,
a details database will be created with the name of `malshare_db_name` variable.

OR

- if there is a details database with the name that you provide with `malshare_db_name` variable in **`config.py`**,
this database will be updated with the last 200 entries.

---

###**`epoch_to_datetime.py`**

This script converts epoch time format into datetime format of a details database with 4 columns;

- **hash**
- **f_type**
- **source**
- **date** (in epoch format)

Name of the details database with the date column in epoch format needs to be provided with `db_to_convert` variable
in **`config.py`**.

This script can be used for 2 different situations;

**1)** To insert new rows with datetime format to an existing details database. Follow these instructions:

Name of the details database with the date column in datetime format which will be updated needs to be provided with
`converted_db` variable in **`config.py`**.

After the configuration, just run the script and it will convert every row's date column with datetime format and will
insert to a new database which will be created with 4 columns;

- **hash**
- **f_type**
- **source**
- **date** (in datetime format)

**2)** To insert rows with datetime format to a new details database which will be created. Follow these instructions:

Name of the details database with the date column in datetime format which will be created needs to be provided with
`converted_db` variable in **`config.py`**.

---

###**`rss_tracker.py`**

This script parses [OpenBugBounty](https://www.openbugbounty.org/) and [CyberCrime-Tracker](http://cybercrime-tracker.net/)
websites' **RSS** feed by using `feedparser` library.

RSS feed for these websites are:

- [OpenBugBounty RSS feed ](http://feeds.feedburner.com/XSSPosed)
- [CyberCrime-Tracker RSS feed](http://cybercrime-tracker.net/rss.xml)

In the folder that you provide with `api_database_folder` variable in **`config.py`**, a database will be created with
the name that you provide with `openbugbounty_db_name` and `cybercrimetracker_db_name` variables in **`config.py`** for
each website.

This database will have 3 columns;

- **source**
- **f_type**
- **date** (in datetime format)

---


## Bash Scripts

In the **`bin/`** folder there are 3 bash scripts that needs to be used for API. Before using them they need to be modified.
So here are the instructions for how they should be modified.

Once again these scripts are only for running the whole project as an API. These 3 scripts need to be put to a job
scheduler. 

>e.g. **crontab**

###**`run_daily_digest.sh `**

This bash script is for running `malshare_script.py` with `--update24` argument. You can find the documentation of this
argument [here](./scripts/#python-scripts).

**`run_daily_digest.sh `** is for getting the hashes and details of each hash which belongs to yesterday.

Since malshare puts the all hashes of a day at 01.30(GMT) to their [archives](https://malshare.com/daily/), this scripts
needs to be run **after 01.30 am (GMT)** to be able to get the all data belongs to yesterday.


**`config.py`** needs to be modified before starting to run this script as desired.

Path of the virtual environment needs to be provided correctly in this script. Otherwise, `malshare_script.py` may not be
able to find needed libraries and most probably will not run properly.

Initially `run_daily_digest.sh` is activating a virtual environment named **venv**.

###**`run_malshare_script.sh`**

This bash script is for running `malshare_script.py` with `--update` argument. You can find the documentation of this
argument [here](./scripts/#python-scripts).

**`run_daily_digest.sh`** is for keeping the details database up to date which will be running for our API.

**`config.py`** needs to be modified before starting to run this script as desired.

Path of the virtual environment needs to be provided correctly in this script. Otherwise, `malshare_script.py` may not be
able to find needed libraries and most probably will not run properly.

Initially `run_malshare_script.sh` is activating a virtual environment named **venv**.

###**`run_rss_tracker.sh`**

This bash script is for running `rss_tracker.py`. You can find the documentation of this python script 
[here](./scripts/#python-scripts).

**`run_daily_digest.sh `** is for parsing the RSS feed of 2 websites;

- [OpenBugBounty RSS feed ](http://feeds.feedburner.com/XSSPosed)
- [CyberCrime-Tracker RSS feed](http://cybercrime-tracker.net/rss.xml)

Path of the virtual environment needs to be provided correctly in this script. Otherwise, `rss_tracker.py` may not be
able to find needed libraries and most probably will not run properly.

Initially `run_rss_tracker.sh` is activating a virtual environment named **venv**.

